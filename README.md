# OMRS

## 功能及操作步骤
重点介绍了程序的功能介绍，以及本软件的具体的操作步骤和修改步骤。
本软件主要是将输入进来的光学乐谱图像进行检测，并输出乐谱图像中所有音符的信息。通过目标检测算法可以得到各类音符的位置坐标以及语义信息，通过解析乐谱中音符的语义信息，得到乐谱中所有音符的音高与时值信息。其目的就是将乐谱图像信息转化为可存储和读取的数字信息。
其中乐谱图像中的音符信息主要有以下：
（1）音符的位置：每个音符的的最小外接矩阵，即音符的锚框。
（2）音符的类别：每个音符都具有特定的作用，所以需要识别音符的具体类别。
（3）音符的时值：音符的持续时间。通过识别音符的符头、符尾和符干的不同，生成音符的时值信息。
（4）音符的音高：即音符的高度，通过识别音符位于五线谱的位置，生成音符音高的信息。
以上的音符信息包含了光学乐谱图像中绝大部分的音符，通过对光学乐谱识别后的解析，即可完成将乐谱图像信息转换为计算机可读取和存储的数字信息，完成光学乐谱识别软件的技术的研究与开发。

## 对于文本框中的信息显示，可以得到以下信息：
（1）文本框中的信息是对检测后的结果进行布局操作后的可视化，具有所有的检测后的结果。
（2）布局显示的依据是按照实际读谱的顺序进行的划分，并在完成本行的读取输出之后会在本行的末尾添加回车符号当做本行结束的标志。
同时，进行检测完毕之后会在内存中将本次检测的结果进行储存，主要储存一下几个文件：具有检测结果的图片（便于进行检测结果可视化），例如：0000211.jpg；包含检测结果的txt文档，其中具有每一个检测出的音符的类别以及此类别位于原图像的四点坐标（锚框位于乐谱图像X轴和Y轴的最大值和最小值），例：labels；包含乐谱图像信息和所有检测音符的标签及位置坐标信息的XML文件，XML文件是决定光学乐谱识别技术的关键，例：xml；经过对XML文件进行解析后产生的布局文件，布局文件是按照实际的读谱顺序生成的，便于通过对布局文件的解析生成乐谱实际的音高与时值信息，例：mung。文件内容如下所示。





## 实现功能
本设计中最终实现了以下的功能：
（1）按照本设计的需要，对收集到的数据集进行相应的标注信息，并对标注生成的xml文件进行解析，得到yolov5模型能够识别的数据。并能够自动的划分数据，生成模型训练需要的训练集和验证集。
（2）按照需求修改数据模块文件和模型模块文件。并对模型进行了适当的调整，以满足最终检测的目的要求。
（3）使用远程服务器进行训练，并解析训练结果。
（4）识别需要的符号的类别以及音符的时值、音高等。该模型以整张的乐谱作为输入，输出乐谱中每个音符的类别。做到了由光学乐谱图像转换为计算机可存储和读取的数字图像。
（5）输出了具有数字信息的文件，例如：包含乐谱图像信息和所有检测目标音符的信息及坐标的XML文件；经过解析XML文件的目标音符和坐标生成的布局文件。具有后续可操作性。
（6）设计了光学乐谱识别软件的Ui界面，使操作和可视化更方便和简单。
## 测试及总结
（1）光学乐谱软件开启界面：

（2）当未点击“打开乐谱”，直接开始“检测乐谱”时，软件会进行提示：

（3）“打开乐谱”按钮开始操作，并自行选择一张将要检测的乐谱：

（4）“检测乐谱”按钮开始操作，并同时生成可乐谱图像视化以及检测结果布局可视化在控件中：

（5）同时会在内存中生成本次乐谱检测的可视化图片以及数字文件：

（6）重新点击“打开乐谱”按钮。并再次自行选择一张将要检测的乐谱，同时会将上次检测的图像可视化和布局可视化的结果清除。

（7）重新点击“检测乐谱”按钮，并生成新乐谱的可视化结果：

（8）同时会在内存中生成本次乐谱检测的可视化图片以及数字文件：

（9）点击退出按钮后，则软件退出
## 总结及展望
在上一节显示了软件的测试效果。对于检测到的音符，软件在该乐谱上绘制了预测音符的边界框，显示了符号的时值和音高，在光学乐谱图像中，识别结果几乎完全正确。仔细看音符符头上的数宇，共有两个数字：一个表示音符的时值，另一个表示音符的音高，这些数字代表了模型预测音符的时值和音高，其中时值和音高标签对应的映射表已经说明了。其余的音符例如休止符、谱号、调号等，也得到了很好的识别。最终实现了通过使用YOLO-v5目标检测算法的乐谱的音符的识别过程。
在本设计中可以直接获得的音符时值和音高而不需要检测符尾、附点或符梁等符号。这是该模型突出的优势，省去了检测繁琐的音乐符号，同时也省略了符号的重建步骤，直接端到端的输出音符的时值和音高。实现了由光学乐谱图像转换为计算机可读取的数字图像，在光学乐谱识别软件领域实现了突破。对数字乐谱保存、手写乐谱保存、翻谱装置等的设计提供了大量的前提保障。
而通过使用Ui界面的方式，让本软件的设计操作起来更方便、可视化效果更明显，并且能将布局后的检测结果进行呈现。而在项目存储空间中保存了经过检测后的光学乐谱图像的可视化文件和数字化文件，例如，XML文件和布局文件，为后续操作提供了保障
在后续的操作中，本软件仍然具有进步的空间，例如：
（1）本模型对于音高过高或者过低的音符和时长过短音符识别精准度不高，在本设计中，模型只能识别到音高标注信息从-10至20之内的音高，时长标注信息从全音符至128分音符之间的时长，此范围已经包含了乐谱中绝大多数的音高和时长信息。但是此范围之外的音高和时长信息不能识别。
（2）通过读取检测后生成的XML可读取文件，对于检测到的音符进行矢量化操作，构建音乐符号图，该符号同时包含这些符号及其相互之间的关系。对于完整而明确的重构，两种关系是必要的：逻辑关系和时间关系以保证符号的正确顺序。
（3）给定完整的音乐符号图，可以将乐谱明确地编码为任何输出格式，例
如，以MIDI进行回放，或以MusicXML/MEI进行进一步的音乐编码程序编辑。
